# laravel-review-guide

Laravelを長年使用してきた経験から、コードレビューする際にチェックするポイントをまとめました。

## 共通

### 変数の初期化
変数が定義されていること。特にループ内で変数が定義されている場合には、ループの外で定義するように移動する。

### 引数の型が定義されていること
特定のModelなのか、Collectionなのか、arrayなのか、明示して知らせてほしい。

また、引数がnullableなのかについても明示すると、とても親切です。

### メソッドの返り値の型が定義されていること
引数と同様に、特定のModelなのか、Collectionなのか、arrayなのか、明示して知らせてほしい。

## FatControllerからSlimControllerへ
FatControllerはテストを難しくします。

処理を別クラスに切り出して、SlimController化することで、切り出したクラスごとにテストを作成することができるようになります。

### ValidationはFormRequestを継承したクラスへ
Controller内のValidation処理をFormRequestを継承したRequestクラスへ移行します。

これにより、ControllerをSlim化することができるようになります。Requestクラスのテストを作成しましょう。

また、dataProviderを使用することで、パターンを網羅したテストを行うことができるようになります。

### 認可処理をPolicyクラスへ
複数Roleがあるサービスの場合、Controller内の認可処理をPolicyクラスに移行します。

これにより、ControllerをSlim化することができるようになります。Policyクラスのテストを作成しましょう。

### Controller内の処理をServiceクラスやUseCaseクラスへ
Controller内の処理をServiceクラスやUseCaseクラスに移行します。
必要に応じて、Repositoryクラスを作成して、モデルの処理をそちらに移行することで、さらに再利用しやすくなります。

以上のアプローチにより、Controller内の処理を$requestの処理と画面遷移の処理に集中させることができるようになります。

## Model
### ローカルスコープを定義して、再利用できるように
よく使われるクエリをローカルスコープとしてモデルに定義することで、再利用性が高まります。

### アクセサとミューテタ
定型の文字列処理を行ってAPIに返したりする場合には、アクセサやミューテタを使うようにしましょう。

## その他
### Eagerロードを使って、「Ｎ＋１」クエリ問題を解消
遅延ロードを使うと、「Ｎ＋１」クエリ問題がある場合に、性能が悪化します。
Eagerロードを使うことで、クエリの呼び出し回数を最小化することができます。
